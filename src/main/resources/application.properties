# Application Configuration
quarkus.application.name=village-calendar
quarkus.http.port=8030

# Proxy configuration (for running behind reverse proxy with SSL termination)
quarkus.http.proxy.proxy-address-forwarding=true
quarkus.http.proxy.enable-forwarded-header=true

# Frontend URL for OAuth redirects (optional - empty/missing in production when served from same origin)
%dev.app.frontend.url=http://localhost:5176
%test.app.frontend.url=http://localhost:8081

# Database Configuration
quarkus.hibernate-orm.active=true
quarkus.hibernate-orm.packages=villagecompute.calendar.data.models,io.quarkus.hibernate.orm.panache
quarkus.hibernate-orm.database.generation=update
quarkus.hibernate-orm.log.sql=false
quarkus.hibernate-orm.physical-naming-strategy=org.hibernate.boot.model.naming.CamelCaseToUnderscoresNamingStrategy
quarkus.hibernate-orm.mapping.format.global=ignore

quarkus.datasource.db-kind=postgresql
quarkus.datasource.jdbc.url=${DB_URL:jdbc:postgresql://localhost:5532/calendar}
quarkus.datasource.username=${DB_USERNAME:calendar}
quarkus.datasource.password=${DB_PASSWORD:calendar}

# REST Configuration
quarkus.rest.path=/api
quarkus.rest.jackson.optimization.enable-reflection-free-serializers=true

# Quinoa Configuration (Vue.js Frontend Integration)
quarkus.quinoa.package-manager-install.node-version=22.19.0
quarkus.quinoa.package-manager-install.npm-version=10.9.2

quarkus.quinoa.dev-server.host=localhost
quarkus.quinoa.dev-server.port=5176
quarkus.quinoa.dev-server.check-timeout=60000
quarkus.quinoa.build-dir=dist
quarkus.quinoa.enable-spa-routing=true
quarkus.quinoa.ignored-path-prefixes=/api,/q,/graphql,/auth/login,/auth/google,/auth/facebook,/auth/apple,/auth/me,/assets,/favicon.ico,/pages,/static

# Default build command
quarkus.quinoa.package-manager-command.build=run build

# GraphQL Configuration
quarkus.smallrye-graphql.ui.enable=true
quarkus.smallrye-graphql.ui.always-include=true
quarkus.smallrye-graphql.root-path=/graphql
quarkus.smallrye-graphql.ui.root-path=/graphql-ui
quarkus.smallrye-graphql.print-data-fetcher-exception=true
quarkus.smallrye-graphql.error-extension-fields=exception,classification,code
quarkus.smallrye-graphql.additional-scalars=JSON

# OpenAPI Configuration
quarkus.smallrye-openapi.path=/q/openapi
quarkus.smallrye-openapi.info-title=Village Calendar Service REST API
quarkus.smallrye-openapi.info-version=1.0.0
quarkus.smallrye-openapi.info-description=REST API for webhooks, OAuth2 authentication, and health monitoring. For calendar operations, use the GraphQL API at /graphql.
quarkus.smallrye-openapi.info-contact-name=VillageCompute Support
quarkus.smallrye-openapi.info-contact-url=https://villagecompute.com
quarkus.swagger-ui.always-include=true
quarkus.swagger-ui.path=/q/swagger-ui

# Index Jackson classes for GraphQL JSON scalar support
quarkus.index-dependency.jackson.group-id=com.fasterxml.jackson.core
quarkus.index-dependency.jackson.artifact-id=jackson-databind

# OAuth2 / OIDC Configuration (Google)
quarkus.oidc.google.enabled=true
quarkus.oidc.google.provider=google
quarkus.oidc.google.client-id=${GOOGLE_CLIENT_ID:placeholder}
quarkus.oidc.google.credentials.secret=${GOOGLE_CLIENT_SECRET:placeholder}
quarkus.oidc.google.application-type=web-app
quarkus.oidc.google.authentication.redirect-path=/api/auth/google/callback
quarkus.oidc.google.authentication.cookie-path=/
quarkus.oidc.google.authentication.scopes=openid,profile,email
quarkus.oidc.google.token.verify-access-token-with-user-info=true
quarkus.oidc.google.authentication.user-info-required=true

# OAuth2 / OIDC Configuration (Facebook)
quarkus.oidc.facebook.enabled=false
quarkus.oidc.facebook.provider=facebook
quarkus.oidc.facebook.client-id=${FACEBOOK_CLIENT_ID:placeholder}
quarkus.oidc.facebook.credentials.secret=${FACEBOOK_CLIENT_SECRET:placeholder}
quarkus.oidc.facebook.application-type=web-app
quarkus.oidc.facebook.authentication.redirect-path=/api/auth/facebook/callback
quarkus.oidc.facebook.authentication.cookie-path=/

# OAuth2 / OIDC Configuration (Apple)
quarkus.oidc.apple.enabled=false
quarkus.oidc.apple.auth-server-url=https://appleid.apple.com
quarkus.oidc.apple.client-id=${APPLE_CLIENT_ID:placeholder}
quarkus.oidc.apple.credentials.secret=${APPLE_CLIENT_SECRET:placeholder}
quarkus.oidc.apple.application-type=web-app
quarkus.oidc.apple.authentication.redirect-path=/api/auth/apple/callback
quarkus.oidc.apple.authentication.cookie-path=/
quarkus.oidc.apple.authentication.scopes=openid,email,name
quarkus.oidc.apple.token.verify-access-token-with-user-info=true
quarkus.oidc.apple.authentication.user-info-required=true
# Apple-specific configuration: requires form_post response mode
quarkus.oidc.apple.authentication.extra-params.response_mode=form_post
# Apple requires manual endpoint configuration (no OIDC discovery)
quarkus.oidc.apple.discovery-enabled=false
quarkus.oidc.apple.authorization-path=/auth/authorize
quarkus.oidc.apple.token-path=/auth/token
quarkus.oidc.apple.jwks-path=/auth/keys
quarkus.oidc.apple.user-info-path=/auth/userinfo

# JWT Configuration
mp.jwt.verify.publickey.location=${JWT_PUBLIC_KEY:classpath:/jwt-public-key.pem}
mp.jwt.verify.issuer=village-calendar
smallrye.jwt.sign.key.location=${JWT_PRIVATE_KEY:classpath:/jwt-private-key.pem}
smallrye.jwt.token.issuer=village-calendar
smallrye.jwt.token.lifespan=86400

# Use JWT (Bearer token) for GraphQL endpoint
quarkus.http.auth.permission.graphql-jwt.paths=/graphql
quarkus.http.auth.permission.graphql-jwt.policy=permit
quarkus.http.auth.permission.graphql-jwt.auth-mechanism=bearer

# Disable default OIDC tenant (we use named tenants like 'google')
quarkus.oidc.tenant-enabled=false

# Mailer Configuration (for order confirmations)
# Default to mailpit for local dev, override with env vars for production
quarkus.mailer.from=${QUARKUS_MAILER_FROM:noreply@villagecompute.com}
quarkus.mailer.host=${QUARKUS_MAILER_HOST:localhost}
quarkus.mailer.port=${QUARKUS_MAILER_PORT:1025}
quarkus.mailer.start-tls=${QUARKUS_MAILER_START_TLS:DISABLED}
quarkus.mailer.username=${QUARKUS_MAILER_USERNAME:}
quarkus.mailer.password=${QUARKUS_MAILER_PASSWORD:}
quarkus.mailer.auth-methods=DIGEST-MD5 CRAM-SHA256 CRAM-SHA1 CRAM-MD5 PLAIN LOGIN
quarkus.mailer.mock=false

# Email Settings
mail.enabled=${MAIL_ENABLED:true}
email.order.from=${EMAIL_ORDER_FROM:Village Compute Calendar <orders@villagecompute.com>}
email.admin.to=${EMAIL_ADMIN_TO:terrence.curran@villagecompute.com}
email.safe-test-domains=${EMAIL_SAFE_TEST_DOMAINS:villagecompute.com,grilledcheese.com,approachingpi.com}

# Application Base URL (for email links)
app.base-url=${APP_BASE_URL:https://calendar.villagecompute.com}

# S3 / R2 Configuration (Cloudflare R2 for PDF storage)
calendar.r2.endpoint=${R2_ENDPOINT:https://placeholder.r2.cloudflarestorage.com}
calendar.r2.bucket=${R2_BUCKET:calendar-pdfs}
calendar.r2.access-key=${R2_ACCESS_KEY:placeholder}
calendar.r2.secret-key=${R2_SECRET_KEY:placeholder}
calendar.r2.public-url=${R2_PUBLIC_URL:https://calendars.villagecompute.com}

# HTTP Cache Configuration
quarkus.http.filter.others.header.Cache-Control=no-cache
quarkus.http.filter.others.matches=/.*
quarkus.http.filter.others.methods=GET
quarkus.http.filter.others.order=0
quarkus.http.filter.static.header.Cache-Control=max-age=31536000
quarkus.http.filter.static.matches=/assets/.+
quarkus.http.filter.static.methods=GET
quarkus.http.filter.static.order=1

# Stripe Configuration (for calendar purchases)
stripe.api.key=${STRIPE_SECRET_KEY:sk_test_placeholder}
stripe.publishable.key=${STRIPE_PUBLISHABLE_KEY:pk_test_placeholder}
stripe.webhook.secret=${STRIPE_WEBHOOK_SECRET:whsec_placeholder}

# Shipping Rate Configuration (for calendar orders)
calendar.shipping.domestic.standard=${SHIPPING_STANDARD:5.99}
calendar.shipping.domestic.priority=${SHIPPING_PRIORITY:9.99}
calendar.shipping.domestic.express=${SHIPPING_EXPRESS:14.99}
calendar.shipping.international=${SHIPPING_INTERNATIONAL:19.99}

# Logging
quarkus.log.level=INFO
quarkus.log.min-level=DEBUG

# OpenTelemetry Configuration
quarkus.otel.sdk.disabled=true
quarkus.otel.traces.enabled=true
quarkus.otel.metrics.enabled=true
quarkus.otel.logs.enabled=true

# OTLP exporter settings (use HTTP/protobuf on port 4318, not gRPC on 4317)
quarkus.otel.exporter.otlp.endpoint=${OTEL_EXPORTER_OTLP_ENDPOINT:http://localhost:4318}
quarkus.otel.exporter.otlp.traces.endpoint=${OTEL_EXPORTER_OTLP_ENDPOINT:http://localhost:4318}
quarkus.otel.exporter.otlp.metrics.endpoint=${OTEL_EXPORTER_OTLP_ENDPOINT:http://localhost:4318}
quarkus.otel.exporter.otlp.logs.endpoint=${OTEL_EXPORTER_OTLP_ENDPOINT:http://localhost:4318}
quarkus.otel.exporter.otlp.protocol=http/protobuf
quarkus.otel.exporter.otlp.timeout=10s

# Resource attributes
quarkus.otel.resource.attributes=service.name=village-calendar,service.version=1.0.0,deployment.environment=${quarkus.profile:dev}

# Trace sampling
quarkus.otel.traces.sampler=always_on

# Context propagation
quarkus.otel.propagators=tracecontext,baggage

# ===============================
# Quarkus ROQ Static Site Configuration
# ===============================
site.url=http://localhost:8080
%dev.site.url=http://localhost:8080
%beta.site.url=https://calendar-beta.villagecompute.com
%prod.site.url=https://calendar.villagecompute.com
site.path-prefix=/pages
